<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Underground Railroad Scanner</title>
    <!-- Local Leaflet CSS -->
    <link rel="stylesheet" href="leaflet.css" />
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        display: flex;
        background: #000;
        overflow: hidden;
      }

      /* Welcome Modal */
      #welcome-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Courier New", monospace;
      }
      .modal-content {
        background: #1a1a1a;
        padding: 40px;
        border: 2px solid #800080;
        text-align: center;
        max-width: 600px;
        color: #26ff00;
        box-shadow: 0 0 30px rgba(128, 0, 128, 0.5);
      }
      .modal-content h1 {
        border-bottom: 1px solid #800080;
        padding-bottom: 15px;
        margin-top: 0;
      }
      .modal-content p {
        line-height: 1.6;
        font-size: 14px;
        color: #ccc;
      }
      .modal-content button {
        background: transparent;
        color: #ff0000;
        border: 1px solid #ff0000;
        padding: 12px 25px;
        cursor: pointer;
        margin-top: 25px;
        font-family: "Courier New", monospace;
        font-weight: bold;
        transition: 0.3s;
      }
      .modal-content button:hover {
        background: #ff0000;
        color: #000;
      }

      #sidebar {
        width: 280px;
        background: #1a1a1a;
        color: #fe1313;
        font-family: "Courier New", monospace;
        padding: 20px;
        border-right: 2px solid #800000;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.5);
        z-index: 1100;
        overflow-y: auto;
      }
      #sidebar h2 {
        font-size: 18px;
        border-bottom: 1px solid #800080;
        padding-bottom: 10px;
      }
      #haven-list {
        list-style: none;
        padding: 0;
      }
      .haven-item {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #333;
        transition: 0.3s;
        opacity: 0.5;
        font-size: 13px;
      }
      .haven-item.found {
        opacity: 1;
        border-color: #51ff00;
        color: #26ff00;
        background: rgba(0, 255, 204, 0.1);
      }

      #map {
        flex-grow: 1;
        height: 100vh;
        background: #060000;
        cursor: crosshair;
      }
      .leaflet-tile-pane {
        filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
      }

      .ui-overlay {
        position: absolute;
        top: 20px;
        left: calc(50% + 140px);
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        color: #000000;
        padding: 12px 24px;
        border: 2px solid #000000;
        border-radius: 5px;
        font-family: "Courier New", monospace;
        font-weight: bold;
        pointer-events: none;
      }

      /* FIXED: Ensure pane allows pointer events so entire circle can be clicked */
      .leaflet-secret-pane {
        z-index: 650;
        pointer-events: auto !important;
        filter: drop-shadow(0 0 15px #a316a5) brightness(1.2);
        clip-path: circle(0px at 0px 0px);
      }
    </style>
  </head>
  <body>
    <div id="welcome-modal">
      <div class="modal-content">
        <h1>THE UNDERGROUND RAILROAD</h1>
        <p>
          Welcome to the exhibit! In this exhibit, you will learn about the
          Underground Railroad and where it was throughout America. Use the
          scanner to find hidden routes and safe houses. Click on the safe
          houses to learn about it and how the abolitonists fought back.
        </p>
        <button onclick="closeWelcome()">INITIALIZE SCANNER</button>
      </div>
    </div>

    <div id="sidebar">
      <h2>SAFE HOUSES FOUND</h2>
      <ul id="haven-list"></ul>
    </div>
    <div class="ui-overlay" id="ui-box">
      UNDERGROUND RAILROAD: <span id="count">0</span>/10 FOUND
    </div>
    <div id="map"></div>

    <!-- Local Leaflet JS -->
    <script src="leaflet.js"></script>

    <script>
      function closeWelcome() {
        document.getElementById("welcome-modal").style.display = "none";
      }

      window.onload = function () {
        var map = L.map("map").setView([37.0, -92.0], 4);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
          map,
        );

        var secretPane = map.createPane("secretPane");
        var s = {
          color: "#ff0000",
          weight: 5,
          dashArray: "10, 15",
          pane: "secretPane",
          opacity: 0.8,
        };

        const routes = [
          [
            [33.7, -84.4],
            [35.6, -82.5],
            [38.4, -76.1],
            [39.9, -75.1],
            [40.7, -74.0],
            [43.1, -79.2],
          ],
          [
            [32.3, -86.3],
            [36.1, -86.7],
            [38.2, -85.7],
            [40.0, -83.0],
            [41.5, -81.7],
            [42.3, -83.0],
          ],
          [
            [30.0, -90.0],
            [34.7, -92.3],
            [38.6, -90.2],
            [41.8, -87.6],
            [43.0, -87.9],
          ],
          [
            [25.7, -80.1],
            [32.7, -79.9],
            [36.8, -76.2],
            [40.7, -74.0],
            [42.3, -71.0],
          ],
          [
            [30.2, -97.7],
            [29.4, -98.4],
            [27.5, -99.5],
          ],
        ];
        routes.forEach((coords) => L.polyline(coords, s).addTo(map));

        var havens = [
          {
            id: "h1",
            p: [42.5, -82.1],
            n: "Dawn Settlement, ON",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_0#slide=id.g3ca5bc7cafc_0_0",
          },
          {
            id: "h2",
            p: [42.3, -83.0],
            n: "Detroit, MI (Midnight)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_5#slide=id.g3ca5bc7cafc_0_5",
          },
          {
            id: "h3",
            p: [43.1, -79.2],
            n: "St. Catharines, ON",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_12#slide=id.g3ca5bc7cafc_0_12",
          },
          {
            id: "h4",
            p: [39.9, -75.1],
            n: "Philadelphia, PA",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_15#slide=id.g3ca5bc7cafc_0_15",
          },
          {
            id: "h5",
            p: [41.8, -87.6],
            n: "Chicago, IL",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_18#slide=id.g3ca5bc7cafc_0_18",
          },
          {
            id: "h6",
            p: [27.5, -99.5],
            n: "Laredo, TX (Mexico)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_21#slide=id.g3ca5bc7cafc_0_21",
          },
          {
            id: "h7",
            p: [38.7, -83.7],
            n: "The Rankin House, OH",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_24#slide=id.g3ca5bc7cafc_0_24",
          },
          {
            id: "h8",
            p: [42.3, -71.0],
            n: "Boston, MA",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_27#slide=id.g3ca5bc7cafc_0_27",
          },
          {
            id: "h9",
            p: [25.8, -80.2],
            n: "Miami, FL (Bahamas)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_30#slide=id.g3ca5bc7cafc_0_30",
          },
          {
            id: "h10",
            p: [44.7, -63.6],
            n: "Africville, NS",
            url: "https://docs.google.com/presentation/d/101dKpazE6dYJTDdbJFzcVQz5ukE-ZCQogphyXVL3Zac/edit?slide=id.p#slide=id.p",
          },
        ];

        var listContainer = document.getElementById("haven-list");
        var foundPlaces = new Set();
        var foundCount = 0;

        havens.forEach((h) => {
          var li = document.createElement("li");
          li.id = h.id;
          li.className = "haven-item";
          li.innerText = "[ LOCKED ] " + h.n;
          listContainer.appendChild(li);

          var marker = L.circleMarker(h.p, {
            radius: 12,
            fillColor: "#00ffcc",
            color: "#800080",
            weight: 8,
            fillOpacity: 1,
            pane: "secretPane",
            interactive: true,
          }).addTo(map);

          marker.on("mouseover", function () {
            map.getContainer().style.cursor = "pointer";
            if (!foundPlaces.has(h.n)) {
              foundPlaces.add(h.n);
              foundCount++;
              document.getElementById("count").innerText = foundCount;
              var listItem = document.getElementById(h.id);
              listItem.classList.add("found");
              listItem.innerText = "[ FOUND ] " + h.n;
              if (foundCount === 10)
                document.getElementById("ui-box").innerText =
                  "ALL HAVENS FOUND!";
            }
          });

          marker.on("mouseout", function () {
            map.getContainer().style.cursor = "crosshair";
          });
          marker.on("click", function () {
            window.open(h.url, "_blank");
          });
        });

        map.on("mousemove", function (e) {
          var pane = map.getPane("secretPane");
          if (pane)
            pane.style.clipPath = `circle(50px at ${e.containerPoint.x}px ${e.containerPoint.y}px)`;
        });
      };
    </script>
  </body>
</html>
