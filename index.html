<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Underground Railroad Scanner</title>
    <link rel="stylesheet" href="leaflet.css" />
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        display: flex;
        background: #000;
        overflow: hidden;
      }

      #sidebar {
        width: 280px;
        background: #1a1a1a;
        color: #fe1313;
        font-family: "Courier New", monospace;
        padding: 20px;
        border-right: 2px solid #800000;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.5);
        z-index: 1100;
        overflow-y: auto;
      }
      #sidebar h2 {
        font-size: 18px;
        border-bottom: 1px solid #800080;
        padding-bottom: 10px;
      }
      #haven-list {
        list-style: none;
        padding: 0;
      }
      .haven-item {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #333;
        transition: 0.3s;
        opacity: 0.5;
        font-size: 13px;
      }

      .haven-item.found {
        opacity: 1;
        border-color: #51ff00;
        color: #26ff00;
        background: rgba(0, 255, 204, 0.1);
      }

      #map {
        flex-grow: 1;
        height: 100vh;
        background: #060000;
        cursor: crosshair;
      }

      .leaflet-tile-pane {
        filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
      }

      .ui-overlay {
        position: absolute;
        top: 20px;
        left: calc(50% + 140px);
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        color: #000000;
        padding: 12px 24px;
        border: 2px solid #000000;
        border-radius: 5px;
        font-family: "Courier New", monospace;
        font-weight: bold;
        pointer-events: none;
      }

      .leaflet-secret-pane {
        z-index: 650;
        pointer-events: none !important;
        filter: drop-shadow(0 0 15px #a316a5) brightness(1.2);
        -webkit-mask-image: radial-gradient(
          circle 50px at center,
          black 20%,
          rgba(0, 0, 0, 0.2) 70%,
          transparent 100%
        );
        mask-image: radial-gradient(
          circle 50px at center,
          black 20%,
          rgba(0, 0, 0, 0.2) 70%,
          transparent 100%
        );
        clip-path: circle(0px at 0px 0px);
      }
    </style>
  </head>
  <body>
    <div id="sidebar">
      <h2>SAFE HOUSES FOUND</h2>
      <ul id="haven-list"></ul>
    </div>

    <div class="ui-overlay" id="ui-box">
      UNDERGROUND RAILROAD: <span id="count">0</span>/10 FOUND
    </div>

    <div id="map"></div>

    <script src="leaflet.js"></script>

    <script>
      window.onload = function () {
        var map = L.map("map").setView([37.0, -92.0], 4);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
          map,
        );

        var secretPane = map.createPane("secretPane");
        var s = {
          color: "#ff0000",
          weight: 5,
          dashArray: "10, 15",
          pane: "secretPane",
          opacity: 0.8,
        };

        const routes = [
          [
            [33.7, -84.4],
            [35.6, -82.5],
            [38.4, -76.1],
            [39.9, -75.1],
            [40.7, -74.0],
            [43.1, -79.2],
          ],
          [
            [32.3, -86.3],
            [36.1, -86.7],
            [38.2, -85.7],
            [40.0, -83.0],
            [41.5, -81.7],
            [42.3, -83.0],
          ],
          [
            [30.0, -90.0],
            [34.7, -92.3],
            [38.6, -90.2],
            [41.8, -87.6],
            [43.0, -87.9],
          ],
          [
            [25.7, -80.1],
            [32.7, -79.9],
            [36.8, -76.2],
            [40.7, -74.0],
            [42.3, -71.0],
          ],
          [
            [30.2, -97.7],
            [29.4, -98.4],
            [27.5, -99.5],
          ],
        ];
        routes.forEach((coords) => L.polyline(coords, s).addTo(map));

        var havens = [
          {
            id: "h1",
            p: [42.5, -82.1],
            n: "Dawn Settlement, ON",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_0#slide=id.g3ca5bc7cafc_0_0",
          },
          {
            id: "h2",
            p: [42.3, -83.0],
            n: "Detroit, MI (Midnight)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_5#slide=id.g3ca5bc7cafc_0_5",
          },
          {
            id: "h3",
            p: [43.1, -79.2],
            n: "St. Catharines, ON",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_12#slide=id.g3ca5bc7cafc_0_12",
          },
          {
            id: "h4",
            p: [39.9, -75.1],
            n: "Philadelphia, PA",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_15#slide=id.g3ca5bc7cafc_0_15",
          },
          {
            id: "h5",
            p: [41.8, -87.6],
            n: "Chicago, IL",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_18#slide=id.g3ca5bc7cafc_0_18",
          },
          {
            id: "h6",
            p: [27.5, -99.5],
            n: "Laredo, TX (Mexico)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_21#slide=id.g3ca5bc7cafc_0_21",
          },
          {
            id: "h7",
            p: [38.7, -83.7],
            n: "The Rankin House, OH",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_24#slide=id.g3ca5bc7cafc_0_24",
          },
          {
            id: "h8",
            p: [42.3, -71.0],
            n: "Boston, MA",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_27#slide=id.g3ca5bc7cafc_0_27",
          },
          {
            id: "h9",
            p: [25.8, -80.2],
            n: "Miami, FL (Bahamas)",
            url: "https://docs.google.com/presentation/d/1ZpLp5Bui7M6tjMhI1fXi--yg7nkp5ISHeajJ2iaGMHo/edit?slide=id.g3ca5bc7cafc_0_30#slide=id.g3ca5bc7cafc_0_30",
          },
          {
            id: "h10",
            p: [44.7, -63.6],
            n: "Africville, NS",
            url: "https://docs.google.com/presentation/d/101dKpazE6dYJTDdbJFzcVQz5ukE-ZCQogphyXVL3Zac/edit?slide=id.g3c995130b88_0_1#slide=id.g3c995130b88_0_1",
          },
        ];

        var listContainer = document.getElementById("haven-list");
        havens.forEach((h) => {
          var li = document.createElement("li");
          li.id = h.id;
          li.className = "haven-item";
          li.innerText = "[ LOCKED ] " + h.n;
          listContainer.appendChild(li);
        });

        var foundCount = 0;
        var foundPlaces = new Set();

        havens.forEach(function (h) {
          L.circleMarker(h.p, {
            radius: 10,
            fillColor: "#00ffcc",
            color: "#800080",
            weight: 2,
            fillOpacity: 1,
            pane: "secretPane",
          }).addTo(map);

          var ghost = L.circleMarker(h.p, {
            radius: 20,
            stroke: false,
            fillOpacity: 0,
            interactive: true,
          }).addTo(map);

          ghost.bindPopup(
            "<b>" +
              h.n +
              "</b><br><a href='" +
              h.url +
              "' target='_blank'>Historical Site</a>",
          );

          ghost.on("mouseover", function () {
            map.getContainer().style.cursor = "pointer";
            if (!foundPlaces.has(h.n)) {
              foundPlaces.add(h.n);
              foundCount++;
              document.getElementById("count").innerText = foundCount;

              var listItem = document.getElementById(h.id);
              listItem.classList.add("found");
              listItem.innerText = "[ FOUND ] " + h.n;

              if (foundCount === 10)
                document.getElementById("ui-box").innerText =
                  "ALL HAVENS FOUND!";
            }
          });

          ghost.on("mouseout", function () {
            map.getContainer().style.cursor = "crosshair";
          });

          ghost.on("click", function () {
            window.open(h.url, "_blank");
          });
        });

        map.on("mousemove", function (e) {
          var pane = map.getPane("secretPane");
          pane.style.clipPath = `circle(50px at ${e.containerPoint.x}px ${e.containerPoint.y}px)`;
        });

        map.on("mouseout", function () {
          map.getPane("secretPane").style.clipPath = "circle(0px)";
        });
      };
    </script>
  </body>
</html>
